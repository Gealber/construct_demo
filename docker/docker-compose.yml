version: "0.1"

networks:
  general:
    ipam:
      config:
      - subnet: 172.16.238.0/24
  v2:
    ipam:
      config:
      - subnet: 172.16.240.0/24
  v2Translator:
    ipam:
      config:
      - subnet: 172.16.241.0/24
  v2LiteraryCategories:
    ipam:
      config:
      - subnet: 172.16.242.0/24
  v2Upload:
    ipam:
      config:
      - subnet: 172.16.243.0/24
  v2Stories:
    ipam:
      config:
      - subnet: 172.16.244.0/24

services: 
  v2MessageBroker:
    image: nats-streaming:0.16.2-linux
    networks:
      - v2Translator
      - v2LiteraryCategories
      - v2Comments
      - v2Reactions
      - v2Payments
      - v2Posts
      - v2Upload
      - v2Stories
      - v2AccountsTemp
      - v2Notifications
      - v1
    ports:
      - "42222:4222"
      - "8222:8222"
    volumes:
      - ${BOUKKER_GITIGNORE}/v2/message-broker/data:/v2MessageBroker
      #- "./v2MessageBroker:/var/lib/message-broker"
    restart: always
    command: "-m 8222 --store file --dir /v2MessageBroker/datastore --cluster_log_path /v2MessageBroker/cluster_log_path --cluster_id ${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID} --auth ${BOUKKER_V2_MESSAGE_BROKER_TOKEN}"

  v1DB:
    image: mariadb:10.1.41
    ports:
      - "3306:3306"
    networks:
      - v1
    volumes:
      - "${BOUKKER_GITIGNORE}/v1/db/var-lib-mysql:/var/lib/mysql/"
      - "./v1/db/boukker.cnf:/etc/mysql/conf.d/boukker.cnf"
    environment:
      MYSQL_ROOT_PASSWORD: ${BOUKKER_V1_DB_PASSWORD}
      MYSQL_DATABASE: ${BOUKKER_V1_DB_NAME}
      MYSQL_USER: ${BOUKKER_V1_DB_USER}
      MYSQL_PASSWORD: ${BOUKKER_V1_DB_PASSWORD}
    restart: "unless-stopped"

  v1Cache:
    image: memcached:1.5.20
    ports:
      - "11211"
    networks:
      - v1
    volumes:
      - "./v1/memcached/memcached.conf:/etc/memcached.conf"
    restart: "unless-stopped"
  
  v1Server:
    image: ernestofg/boukker-v1-server:2.0.9
    depends_on:
      - "v1DB"
    networks:
      - v1
      - general
      - v2
    ports:
      - "80:80"
      - "7001:7001"
    volumes:
      - "./v1/server/boukker.conf:/etc/apache2/sites-available/boukker.conf"
      - "./v1/boukker-v1v2api/boukker.v1v2api.conf:/etc/apache2/sites-available/boukker.apiv2.conf"
      - "${BOUKKER_V1_SERVER_PHP_PROJECT_DIRECTORY}:/boukker/"
      - "${BOUKKER_GITIGNORE}/v1/boukker-v1v2api/ssl:/boukker-ssl/v1/v1v2api/"
      - "${BOUKKER_GITIGNORE}/v2/boukker-translator/ssl:/boukker-ssl/v2/translator/"
      - "${BOUKKER_GITIGNORE}/v2/boukker-literary-categories/ssl:/boukker-ssl/v2/literary-categories/"
    environment:
      BOUKKER_DB_HOST: v1DB
      BOUKKER_DB_NAME: ${BOUKKER_V1_DB_NAME}
      BOUKKER_DB_USER: ${BOUKKER_V1_DB_USER}
      BOUKKER_DB_PASSWORD: ${BOUKKER_V1_DB_PASSWORD}
      BOUKKER_SERVER_URL: ${BOUKKER_V1_SERVER_URL}
      BOUKKER_MEMCACHE_HOST: "v1Cache"
      BOUKKER_MEMCACHE_PORT: "11211"
      
      BOUKKER_V2_APIGATEWAY_CONNECTION: ${BOUKKER_V2_APIGATEWAY_CONNECTION}
      BOUKKER_V2_UPLOAD_MEDIA_CONNECTION: ${BOUKKER_V2_UPLOAD_MEDIA_CONNECTION}
      BOUKKER_KEY_GENERATE_JWT: "${C_KEY_HANDLE_TOKEN}"
      
      BOUKKER_V2_TRANSLATOR_CONNECTION: v2Translator:50052
      BOUKKER_V2_TRANSLATOR_COMMON_NAME: boukker-translator-service
      BOUKKER_V2_TRANSLATOR_CLIENT_CERT: /boukker-ssl/v2/translator/client/client-cert.pem
      BOUKKER_V2_TRANSLATOR_CLIENT_KEY: /boukker-ssl/v2/translator/client/client-key.pem
      BOUKKER_V2_TRANSLATOR_SERVER_CA_CERT: /boukker-ssl/v2/translator/server/server-ca-cert.pem
      
      BOUKKER_V2_LITERARY_CATEGORIES_CONNECTION: v2LiteraryCategories:50052
      BOUKKER_V2_LITERARY_CATEGORIES_COMMON_NAME: boukker-literary-categories-service
      BOUKKER_V2_LITERARY_CATEGORIES_CLIENT_CERT: /boukker-ssl/v2/literary-categories/client/client-cert.pem
      BOUKKER_V2_LITERARY_CATEGORIES_CLIENT_KEY: /boukker-ssl/v2/literary-categories/client/client-key.pem
      BOUKKER_V2_LITERARY_CATEGORIES_SERVER_CA_CERT: /boukker-ssl/v2/literary-categories/server/server-ca-cert.pem

      BOUKKER_V1_V2_NOTIFICATOR_NATS_HOST: "v2MessageBroker"
      BOUKKER_V1_V2_NOTIFICATOR_NATS_PORT: "4222"
      BOUKKER_V1_V2_NOTIFICATOR_NATS_TOKEN: "${BOUKKER_V2_MESSAGE_BROKER_TOKEN}"
      BOUKKER_V1_V2_NOTIFICATOR_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"
      BOUKKER_V1_V2_NOTIFICATOR_NATS_CLIENT_ID: "v1v2Notificator"
      BOUKKER_V1_V2_NOTIFICATOR_ACCOUNTS_SUBJECT_ON_UPDATE_USER_NAMES: "${BOUKKER_V1_V2_NOTIFICATOR_ACCOUNTS_SUBJECT_ON_UPDATE_USER_NAMES}"
    restart: "unless-stopped"

  v2mongodb:
    image: mongo:4.2.1-bionic
    networks:
      - v2Translator
      - v2LiteraryCategories
      - v2Comments
      - v2Reactions
      - v2Payments
      - v2Chat
      - v2Stories
      - general
      - v2
      - v2AccountsTemp
    volumes:
      - ${BOUKKER_GITIGNORE}/v2/mongo-db/data/db:/data/db
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${BOUKKER_V2_MONGODB_USER}
      MONGO_INITDB_ROOT_PASSWORD: ${BOUKKER_V2_MONGODB_PASSWORD}
    restart: always
  
  v2Redis:
    image: redis:6.0-alpine3.11
    networks:
      - v2MediaREST
      - v2MediaGRPC
    volumes:
      - "./v2/redis/redis.conf:/usr/local/etc/redis/redis.conf"
      - ${BOUKKER_GITIGNORE}/v2/redis/data:/data
    ports:
      - "6379:6379"
    command: "redis-server /usr/local/etc/redis/redis.conf"
    restart: always

  v2Translator:
    image: ernestofg/boukker-translator:dev-915a45ac
    depends_on:
      - "v2mongodb"
    networks:
      - v2
      - v2Translator
      - general
    ports:
      - "7002:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-translator/ssl:/opt/translator/cert"
    environment:
      COMMON_APPNAME: "boukker-translator-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/translator/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/translator/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/translator/cert/client/client-ca-cert.pem"
      
      BOUKKER_TRANSLATOR_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_TRANSLATOR_DB_MONGO_DATABASE: "${BOUKKER_V2_TRANSLATOR_MONGODB_DB_NAME}"
      
      BOUKKER_TRANSLATOR_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_TRANSLATOR_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"
      BOUKKER_TRANSLATOR_SUBSCRIBER_SUBJECT_DELETE_TRANSLATIONS_BY_TRANSKEY: "${BOUKKER_V2_TRANSLATOR_SUBJECT_DELETE_TRANSLATIONS_BY_TRANSKEY}"

    command: "./server"
    restart: "unless-stopped"

  v2LiteraryCategories:
    image: ernestofg/boukker-literary-categories:dev-43fba702
    depends_on:
      - "v2mongodb"
      - "v2MessageBroker"
      - "v2Translator"
    networks:
      - v2
      - v2LiteraryCategories
      - general
    ports:
      - "7003:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-literary-categories/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-translator/ssl:/opt/translator/cert"
    environment:
      COMMON_APPNAME: "boukker-literary-categories-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_LITERARY_CATEGORIES_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_LITERARY_CATEGORIES_DB_MONGO_DATABASE: "${BOUKKER_V2_LITERARY_CATEGORIES_MONGODB_DB_NAME}"
      
      BOUKKER_TRANSLATOR_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_TRANSLATOR_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"
      BOUKKER_TRANSLATOR_PUBLISHER_SUBJECT_DELETE_TRANSLATIONS_BY_TRANSKEY: "${BOUKKER_V2_TRANSLATOR_SUBJECT_DELETE_TRANSLATIONS_BY_TRANSKEY}"

      BOUKKER_LITERARY_CATEGORIES_TRANSMS_SERVER_ADDRESS: "v2Translator:50052"
      BOUKKER_LITERARY_CATEGORIES_TRANSMS_SERVER_NAME: "boukker-translator-service"
      BOUKKER_LITERARY_CATEGORIES_TRANSMS_USE_TLS: "true"
      BOUKKER_LITERARY_CATEGORIES_TRANSMS_CERT: "/opt/translator/cert/client/client-cert.pem"
      BOUKKER_LITERARY_CATEGORIES_TRANSMS_KEY: "/opt/translator/cert/client/client-key.pem"
      BOUKKER_LITERARY_CATEGORIES_TRANSMS_SERVER_CAS: "/opt/translator/cert/server/server-ca-cert.pem"

    command: "./server"
    restart: "unless-stopped"
    
  v2Stories:
    image: ernestofg/boukker-stories:dev-5130c80f
    depends_on:
      - "v2mongodb"
      - "v2MessageBroker"
      - "v2Translator"
      - "v2LiteraryCategories"
      - "v2AccountsTemp"
      - "v2Posts"
    networks:
      - "v2"
      - "v2Stories"
      - "general"
      - "v2Posts"
    ports:
      - "7004:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-stories/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-translator/ssl:/opt/translator/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/accounts/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-grpc/ssl:/opt/media/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-posts/ssl:/opt/posts/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-literary-categories/ssl:/opt/literary-categories/cert"
      
    environment:
      COMMON_APPNAME: "boukker-stories-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_STORIES_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_STORIES_DB_MONGO_DATABASE: "${BOUKKER_V2_STORIES_MONGODB_DB_NAME}"

      BOUKKER_STORIES_TRANSLATOR_CLIENT_SERVER_ADDRESS: "v2Translator:50052"
      BOUKKER_STORIES_TRANSLATOR_CLIENT_SERVER_NAME: "boukker-translator-service"
      BOUKKER_STORIES_TRANSLATOR_CLIENT_USE_TLS: "true"
      BOUKKER_STORIES_TRANSLATOR_CLIENT_CERT: "/opt/translator/cert/client/client-cert.pem"
      BOUKKER_STORIES_TRANSLATOR_CLIENT_KEY: "/opt/translator/cert/client/client-key.pem"
      BOUKKER_STORIES_TRANSLATOR_CLIENT_SERVER_CAS: "/opt/translator/cert/server/server-ca-cert.pem"

      BOUKKER_STORIES_CATEGORY_CLIENT_SERVER_ADDRESS: "v2LiteraryCategories:50052"
      BOUKKER_STORIES_CATEGORY_CLIENT_SERVER_NAME: "boukker-literary-categories-service"
      BOUKKER_STORIES_CATEGORY_CLIENT_USE_TLS: "true"
      BOUKKER_STORIES_CATEGORY_CLIENT_CERT: "/opt/literary-categories/cert/client/client-cert.pem"
      BOUKKER_STORIES_CATEGORY_CLIENT_KEY: "/opt/literary-categories/cert/client/client-key.pem"
      BOUKKER_STORIES_CATEGORY_CLIENT_SERVER_CAS: "/opt/literary-categories/cert/server/server-ca-cert.pem"

      BOUKKER_STORIES_ACCOUNTS_CLIENT_SERVER_ADDRESS: "v2AccountsTemp:50052"
      BOUKKER_STORIES_ACCOUNTS_CLIENT_SERVER_NAME: "boukker-accounts-temp-service"
      BOUKKER_STORIES_ACCOUNTS_CLIENT_USE_TLS: "true"
      BOUKKER_STORIES_ACCOUNTS_CLIENT_CERT: "/opt/accounts/cert/client/client-cert.pem"
      BOUKKER_STORIES_ACCOUNTS_CLIENT_KEY: "/opt/accounts/cert/client/client-key.pem"
      BOUKKER_STORIES_ACCOUNTS_CLIENT_SERVER_CAS: "/opt/accounts/cert/server/server-ca-cert.pem"

      BOUKKER_STORIES_MEDIA_CLIENT_SERVER_ADDRESS: "v2MediaGRPC:50052"
      BOUKKER_STORIES_MEDIA_CLIENT_SERVER_NAME: "boukker-media-grpc-service"
      BOUKKER_STORIES_MEDIA_CLIENT_USE_TLS: "true"
      BOUKKER_STORIES_MEDIA_CLIENT_CERT: "/opt/media/cert/client/client-cert.pem"
      BOUKKER_STORIES_MEDIA_CLIENT_KEY: "/opt/media/cert/client/client-key.pem"
      BOUKKER_STORIES_MEDIA_CLIENT_SERVER_CAS: "/opt/media/cert/server/server-ca-cert.pem"

      BOUKKER_STORIES_POSTS_CLIENT_SERVER_ADDRESS: "v2Posts:50052"
      BOUKKER_STORIES_POSTS_CLIENT_SERVER_NAME: "boukker-posts-service"
      BOUKKER_STORIES_POSTS_CLIENT_USE_TLS: "true"
      BOUKKER_STORIES_POSTS_CLIENT_CERT: "/opt/posts/cert/client/client-cert.pem"
      BOUKKER_STORIES_POSTS_CLIENT_KEY: "/opt/posts/cert/client/client-key.pem"
      BOUKKER_STORIES_POSTS_CLIENT_SERVER_CAS: "/opt/posts/cert/server/server-ca-cert.pem"

      BOUKKER_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"

      # Subscribers
      BOUKKER_STORIES_SUBSCRIBER_SUBJECT_UPDATE_TOTAL_COMMENTS: "commentsMB.stories.updateTotalComments"
      BOUKKER_STORIES_SUBSCRIBER_SUBJECT_UPDATE_TOTAL_REACTIONS: "reactionsMB.stories.updateTotalReactions"
      BOUKKER_STORIES_SUBSCRIBER_SUBJECT_STORY_USER_UPDATE: "stories.accounts.update"
      BOUKKER_STORIES_SUBSCRIBER_SUBJECT_UPDATE_TOTAL_COFFES: "stories.payments.updateCoffes"

      # Publishers
      BOUKKER_COMMENTS_PUBLISHER_SUBJECT_REMOVE_ALL_COMMENTS: "storiesMB.comments.removeAllComments"
      BOUKKER_REACTIONS_PUBLISHER_SUBJECT_REMOVE_ALL_REACTIONS: "mb.reactions.removeAllReactions"
      
    command: "./server"
    restart: "unless-stopped"
  
  v2ApigwSimulator:
    image: ernestofg/bagw-simulator:dev-39038a6f
    depends_on:
      - "v2Translator"
      - "v2LiteraryCategories"
      - "v2Stories"
    networks:
      - "v2"
    ports:
      - "7043:443"
      - "7080:80"
    volumes:
      - "${BOUKKER_GITIGNORE}/simulator/:/data/simulator/"
      - "${BOUKKER_GITIGNORE}/v2/:/data/apps/"
    environment:
      BOUKKER_SIM_SERVER_HTTP_DOMAIN_PORT: ":80"
      BOUKKER_SIM_SERVER_HTTPS_DOMAIN_PORT: ":443"
      BOUKKER_SIM_SERVER_HTTPS_PATH_CERT: "/data/simulator/ssl/server/simulator-cert.pem"
      BOUKKER_SIM_SERVER_HTTPS_PATH_KEY: "/data/simulator/ssl/server/simulator-key.pem"
      ###------- configuraciones comunes del simulador y los handlers(funciones lambdas) -------
      BOUKKER_SIM_TYPE_ENV: "${C_ENV}"
      BOUKKER_SIM_DEBUG: "${C_DEBUG}"
      BOUKKER_SIM_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_SIM_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      ###------- configuraciones comunes de todos los handlers(funciones lambdas) -------
      BOUKAPI_COMMONS_AUTH_PERMISSIONS: "${H_SSM_PERMISSIONS}"
      BOUKAPI_COMMONS_AUTH_PERMISSIONS_FOR_MS: "${H_SSM_PERMISSIONS_FOR_MS}"
      ###------- configuraciones translator(funciones lambdas) -------
      BOUKKER_TRANSLATOR_TYPE_ENV: "${C_ENV}"
      BOUKKER_TRANSLATOR_CERT: "/data/apps/boukker-translator/ssl/client/client-cert.pem"
      BOUKKER_TRANSLATOR_KEY: "/data/apps/boukker-translator/ssl/client/client-key.pem"
      BOUKKER_TRANSLATOR_CAS: "/data/apps/boukker-translator/ssl/server/server-ca-cert.pem"
      BOUKKER_TRANSLATOR_USE_TLS: "true"
      BOUKKER_TRANSLATOR_SERVER_ADDRESS: "v2Translator:50052"
      BOUKKER_TRANSLATOR_SERVER_NAME: "boukker-translator-service"
      BOUKKER_TRANSLATOR_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_TRANSLATOR_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_TRANSLATOR_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_TRANSLATOR_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_TRANSLATOR_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_TRANSLATOR_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_TRANSLATOR_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_TRANSLATOR_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_TRANSLATOR_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_TRANSLATOR_DEBUG: "${C_DEBUG}"
      ###------- configuraciones categories(funciones lambdas) -------
      BOUKKER_CATEGORIES_TYPE_ENV: "${C_ENV}"
      BOUKKER_CATEGORIES_CERT: "/data/apps/boukker-literary-categories/ssl/client/client-cert.pem"
      BOUKKER_CATEGORIES_KEY: "/data/apps/boukker-literary-categories/ssl/client/client-key.pem"
      BOUKKER_CATEGORIES_CAS: "/data/apps/boukker-literary-categories/ssl/server/server-ca-cert.pem"
      BOUKKER_CATEGORIES_USE_TLS: "true"
      BOUKKER_CATEGORIES_SERVER_ADDRESS: "v2LiteraryCategories:50052"
      BOUKKER_CATEGORIES_SERVER_NAME: "boukker-literary-categories-service"
      BOUKKER_CATEGORIES_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_CATEGORIES_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_CATEGORIES_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_CATEGORIES_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_CATEGORIES_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_CATEGORIES_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_CATEGORIES_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_CATEGORIES_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_CATEGORIES_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_CATEGORIES_DEBUG: "${C_DEBUG}"
      ###------- configuraciones stories(funciones lambdas) -------
      BOUKKER_STORIES_TYPE_ENV: "${C_ENV}"
      BOUKKER_STORIES_CERT: "/data/apps/boukker-stories/ssl/client/client-cert.pem"
      BOUKKER_STORIES_KEY: "/data/apps/boukker-stories/ssl/client/client-key.pem"
      BOUKKER_STORIES_CAS: "/data/apps/boukker-stories/ssl/server/server-ca-cert.pem"
      BOUKKER_STORIES_USE_TLS: "true"
      BOUKKER_STORIES_SERVER_ADDRESS: "v2Stories:50052"
      BOUKKER_STORIES_SERVER_NAME: "boukker-stories-service"
      BOUKKER_STORIES_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      BOUKKER_STORIES_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_STORIES_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_STORIES_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_STORIES_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_STORIES_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_STORIES_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_STORIES_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_STORIES_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_STORIES_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_STORIES_DEBUG: "${C_DEBUG}"
      BOUKKER_STORIES_REACTIONS_CERT: "/data/apps/boukker-reactions/ssl/client/client-cert.pem"
      BOUKKER_STORIES_REACTIONS_KEY: "/data/apps/boukker-reactions/ssl/client/client-key.pem"
      BOUKKER_STORIES_REACTIONS_CAS: "/data/apps/boukker-reactions/ssl/server/server-ca-cert.pem"
      BOUKKER_STORIES_REACTIONS_USE_TLS: "true"
      BOUKKER_STORIES_REACTIONS_SERVER_ADDRESS: "v2Reactions:50052"
      BOUKKER_STORIES_REACTIONS_SERVER_NAME: "boukker-reactions-service"
      BOUKKER_STORIES_REACTIONS_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      ###------- configuraciones comments(funciones lambdas) -------
      BOUKKER_COMMENTS_TYPE_ENV: "${C_ENV}"
      BOUKKER_COMMENTS_CERT: "/data/apps/boukker-comments/ssl/client/client-cert.pem"
      BOUKKER_COMMENTS_KEY: "/data/apps/boukker-comments/ssl/client/client-key.pem"
      BOUKKER_COMMENTS_CAS: "/data/apps/boukker-comments/ssl/server/server-ca-cert.pem"
      BOUKKER_COMMENTS_USE_TLS: "true"
      BOUKKER_COMMENTS_SERVER_ADDRESS: "v2Comments:50052"
      BOUKKER_COMMENTS_SERVER_NAME: "boukker-comments-service"
      BOUKKER_COMMENTS_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      BOUKKER_COMMENTS_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_COMMENTS_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_COMMENTS_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_COMMENTS_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_COMMENTS_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_COMMENTS_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_COMMENTS_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_COMMENTS_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_COMMENTS_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_COMMENTS_DEBUG: "${C_DEBUG}"
      ###------- configuraciones reactions(funciones lambdas) -------
      BOUKKER_REACTIONS_TYPE_ENV: "${C_ENV}"
      BOUKKER_REACTIONS_CERT: "/data/apps/boukker-reactions/ssl/client/client-cert.pem"
      BOUKKER_REACTIONS_KEY: "/data/apps/boukker-reactions/ssl/client/client-key.pem"
      BOUKKER_REACTIONS_CAS: "/data/apps/boukker-reactions/ssl/server/server-ca-cert.pem"
      BOUKKER_REACTIONS_USE_TLS: "true"
      BOUKKER_REACTIONS_SERVER_ADDRESS: "v2Reactions:50052"
      BOUKKER_REACTIONS_SERVER_NAME: "boukker-reactions-service"
      BOUKKER_REACTIONS_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      BOUKKER_REACTIONS_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_REACTIONS_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_REACTIONS_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_REACTIONS_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_REACTIONS_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_REACTIONS_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_REACTIONS_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_REACTIONS_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_REACTIONS_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_REACTIONS_DEBUG: "${C_DEBUG}"
      ###------- configuraciones payments(funciones lambdas) -------
      BOUKKER_PAYMENTS_TYPE_ENV: "${C_ENV}"
      BOUKKER_PAYMENTS_CERT: "/data/apps/boukker-payments/ssl/client/client-cert.pem"
      BOUKKER_PAYMENTS_KEY: "/data/apps/boukker-payments/ssl/client/client-key.pem"
      BOUKKER_PAYMENTS_CAS: "/data/apps/boukker-payments/ssl/server/server-ca-cert.pem"
      BOUKKER_PAYMENTS_USE_TLS: "true"
      BOUKKER_PAYMENTS_SERVER_ADDRESS: "v2Payments:50052"
      BOUKKER_PAYMENTS_SERVER_NAME: "boukker-payments-service"
      BOUKKER_PAYMENTS_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      BOUKKER_PAYMENTS_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_PAYMENTS_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_PAYMENTS_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_PAYMENTS_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_PAYMENTS_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_PAYMENTS_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_PAYMENTS_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_PAYMENTS_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_PAYMENTS_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_PAYMENTS_DEBUG: "${C_DEBUG}"
      ###------- configuraciones payments(funciones lambdas) -------
      BOUKKER_BOOKMARKS_TYPE_ENV: "${C_ENV}"
      BOUKKER_BOOKMARKS_CERT: "/data/apps/boukker-stories/ssl/client/client-cert.pem"
      BOUKKER_BOOKMARKS_KEY: "/data/apps/boukker-stories/ssl/client/client-key.pem"
      BOUKKER_BOOKMARKS_CAS: "/data/apps/boukker-stories/ssl/server/server-ca-cert.pem"
      BOUKKER_BOOKMARKS_USE_TLS: "true"
      BOUKKER_BOOKMARKS_SERVER_ADDRESS: "v2Stories:50052"
      BOUKKER_BOOKMARKS_SERVER_NAME: "boukker-stories-service"
      BOUKKER_BOOKMARKS_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}"
      BOUKKER_BOOKMARKS_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}"
      BOUKKER_BOOKMARKS_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}"
      BOUKKER_BOOKMARKS_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}"
      BOUKKER_BOOKMARKS_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}"
      BOUKKER_BOOKMARKS_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}"
      BOUKKER_BOOKMARKS_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}"
      BOUKKER_BOOKMARKS_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}"
      BOUKKER_BOOKMARKS_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}"
      BOUKKER_BOOKMARKS_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}"
      BOUKKER_BOOKMARKS_DEBUG: "${C_DEBUG}"
      ###------- configuraciones chat(funciones lambdas) -------
      BOUKKER_CHAT_TYPE_ENV: "${C_ENV}" 
      BOUKKER_CHAT_CERT: "/data/apps/boukker-chat/ssl/client/client-cert.pem"
      BOUKKER_CHAT_KEY: "/data/apps/boukker-chat/ssl/client/client-key.pem"
      BOUKKER_CHAT_CAS: "/data/apps/boukker-chat/ssl/server/server-ca-cert.pem"
      BOUKKER_CHAT_USE_TLS: "true" 
      BOUKKER_CHAT_SERVER_ADDRESS: "v2Chat:50052" 
      BOUKKER_CHAT_SERVER_NAME: "boukker-chat-service" 
      BOUKKER_CHAT_URL_SERVER_STORE_MEDIAS: "${C_URL_SERVER_STORE_MEDIAS}" 
      BOUKKER_CHAT_SECRET_KEY_HANDLE_TOKEN: "${C_KEY_HANDLE_TOKEN}" 
      BOUKKER_CHAT_HEADER_CORS_HEADERS: "${H_HEADER_CORS_HEADERS}" 
      BOUKKER_CHAT_HEADER_CORS_ORIGIN: "${H_HEADER_CORS_ORIGIN}" 
      BOUKKER_CHAT_HEADER_CORS_METHODS: "${H_HEADER_CORS_METHODS}" 
      BOUKKER_CHAT_RESOURCE_ADMIN: "${C_RESOURCE_ADMIN}" 
      BOUKKER_CHAT_IPS_ALLOW_ADMIN: "${H_IPS_ALLOW_ADMIN}" 
      BOUKKER_CHAT_HEADER_CORS_HEADERS_ADMIN: "${H_HEADER_CORS_HEADERS_ADMIN}" 
      BOUKKER_CHAT_HEADER_CORS_ORIGIN_ADMIN: "${H_HEADER_CORS_ORIGIN_ADMIN}" 
      BOUKKER_CHAT_HEADER_CORS_METHODS_ADMIN: "${H_HEADER_CORS_METHODS_ADMIN}" 
      BOUKKER_CHAT_DEBUG: "${C_DEBUG}"
    command: "./simulator"
    restart: "unless-stopped"

  v2AccountsTemp:
    image: ernestofg/boukker-accounts-temp:dev-xxx
    depends_on:
      - "v1Server"
    networks:
      - v2
      - v2AccountsTemp
      - general
    ports:
      - "7005:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v1/boukker-v1v2api/ssl:/opt/boukker-v1v2api/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-grpc/ssl:/opt/media/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-translator/ssl:/opt/translator/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-literary-categories/ssl:/opt/literary-categories/cert"
    environment:
      COMMON_APPNAME: "boukker-accounts-temp-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"

      # media ms
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_SERVER_ADDRESS: "v2MediaGRPC:50052"
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_SERVER_NAME: "boukker-media-grpc-service"
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_USE_TLS: "true"
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_CERT: "/opt/media/cert/client/client-cert.pem"
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_KEY: "/opt/media/cert/client/client-key.pem"
      BOUKKER_ACCOUNTS_MEDIA_CLIENT_SERVER_CAS: "/opt/media/cert/server/server-ca-cert.pem"
      # translator ms
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_SERVER_ADDRESS: "v2Translator:50052"
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_SERVER_NAME: "boukker-translator-service"
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_USE_TLS: "true"
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_CERT: "/opt/translator/cert/client/client-cert.pem"
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_KEY: "/opt/translator/cert/client/client-key.pem"
      BOUKKER_ACCOUNTS_TRANSLATOR_CLIENT_SERVER_CAS: "/opt/translator/cert/server/server-ca-cert.pem"
      # categories ms
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_SERVER_ADDRESS: "v2LiteraryCategories:50052"
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_SERVER_NAME: "boukker-literary-categories-service"
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_USE_TLS: "true"
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_CERT: "/opt/literary-categories/cert/client/client-cert.pem"
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_KEY: "/opt/literary-categories/cert/client/client-key.pem"
      BOUKKER_ACCOUNTS_CATEGORIES_CLIENT_SERVER_CAS: "/opt/literary-categories/cert/server/server-ca-cert.pem"
      # accounts db
      BOUKKER_ACCOUNTS_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_ACCOUNTS_DB_MONGO_DATABASE: "${BOUKKER_V2_STORIES_MONGODB_DB_NAME}"

      BOUKKER_V1_V2_API_CLIENT_URL: "https://v1Server:7001"
      BOUKKER_V1_V2_API_CLIENT_USE_TLS: "true"
      BOUKKER_V1_V2_API_CLIENT_SERVER_NAME: "boukker-v1v2api-service"
      BOUKKER_V1_V2_API_CLIENT_CERT: "/opt/boukker-v1v2api/cert/client/client-cert.pem"
      BOUKKER_V1_V2_API_CLIENT_KEY: "/opt/boukker-v1v2api/cert/client/client-key.pem"
      BOUKKER_V1_V2_API_CLIENT_SERVER_CAS: "/opt/boukker-v1v2api/cert/server/server-ca-cert.pem"

      BOUKKER_V1_V2_NOTIFICATOR_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_V1_V2_NOTIFICATOR_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"
      BOUKKER_V1_V2_NOTIFICATOR_SUBSCRIBER_SUBJECT_ON_UPDATE_USER_NAMES: "${BOUKKER_V1_V2_NOTIFICATOR_ACCOUNTS_SUBJECT_ON_UPDATE_USER_NAMES}"

      BOUKKER_ACCOUNTS_NOTIFICATOR_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_ACCOUNTS_NOTIFICATOR_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"
      BOUKKER_ACCOUNTS_NOTIFICATOR_PUBLISHER_SUBJECT_USER_NAMES_UPDATE: "${BOUKKER_V2_ACCOUNTS_NOTIFICATOR_SUBJECT_USER_NAMES_UPDATE}"
      BOUKKER_ACCOUNTS_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"

      BOUKKER_REACTIONS_NOTIFICATOR_PUBLISHER_SUBJECT_REACTION_USER_UPDATE: "reactions.accounts.update"
      BOUKKER_STORIES_NOTIFICATOR_PUBLISHER_SUBJECT_STORY_USER_UPDATE: "stories.accounts.update"
      BOUKKER_COMMENTS_NOTIFICATOR_PUBLISHER_SUBJECT_COMMENT_USER_UPDATE: "comments.accounts.update"

    command: "./server"
    restart: "unless-stopped"

  v2MediaGRPC:
    image: ernestofg/boukker-mediams:dev-5dca5f7b
    depends_on:
      - "v2Redis"
    networks:
      - "v2"
      - "v2MediaGRPC"
    ports:
      - "7006:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-grpc/ssl:/opt/media-grpc/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-rest/data:/opt/media" # el volumen es de el media-rest q es donde se suben los archivos

    environment:
      COMMON_APPNAME: "boukker-media-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/media-grpc/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/media-grpc/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/media-grpc/cert/client/client-ca-cert.pem"

      BOUKKER_MEDIA_TYPE_ENV: "local"

      BOUKKER_MEDIA_DB_NETWORK: "tcp"
      BOUKKER_MEDIA_DB_ADDRESS: "v2Redis:6379"
      BOUKKER_MEDIA_DB_PASSWORD: "${BOUKKER_V2_REDIS_PASSWORD}"
      BOUKKER_MEDIA_DB_IDX: "0"
      BOUKKER_MEDIA_DB_PREFIX_HASH: "file"

      BOUKKER_MEDIA_KEY_CIPHER_TOKEN: "12hdjsAS34ffgSDDFaaS567dff89Aaaa"

      BOUKKER_MEDIA_DESTINATION_TYPE: "files-system"
      BOUKKER_MEDIA_DESTINATION_TARGET: "/opt/media"

      ###
      ### configuracion para aws
      ###
      # COMMON_APPNAME: "boukker-media-service"
      # COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      # COMMON_DEBUG: "true"
      # COMMON_USE_TLS: "true"
      # COMMON_CERT: "/opt/media-grpc/cert/server/server-cert.pem"
      # COMMON_KEY: "/opt/media-grpc/cert/server/server-key.pem"
      # COMMON_CLIENT_CAS: "/opt/media-grpc/cert/client/client-ca-cert.pem"

      # BOUKKER_MEDIA_TYPE_ENV: "aws"

      # BOUKKER_MEDIA_DB_NETWORK: "tcp"
      # BOUKKER_MEDIA_DB_ADDRESS: "v2Redis:6379"
      # BOUKKER_MEDIA_DB_PASSWORD: "${BOUKKER_V2_REDIS_PASSWORD}"
      # BOUKKER_MEDIA_DB_IDX: "0"
      # BOUKKER_MEDIA_DB_PREFIX_HASH: "file"

      # BOUKKER_MEDIA_KEY_CIPHER_TOKEN: "12hdjsAS34ffgSDDFaaS567dff89Aaaa"
      # BOUKKER_MEDIA_DESTINATION_TYPE: "/boukker/media/destination-type"
      # BOUKKER_MEDIA_DESTINATION_TARGET: "/boukker/media/destination-target"

      # BOUKKER_MEDIA_S3_ACCESS_KEY: "/boukker/media/s3-access-key"
      # BOUKKER_MEDIA_S3_SECRET_ACCESS_KEY: "/boukker/media/s3-secret-access-key"
      # BOUKKER_MEDIA_S3_TOKEN: "/boukker/media/s3-token"
      # BOUKKER_MEDIA_S3_REGION: "/boukker/media/s3-region"

      # BOUKKER_MEDIA_PARAM_ACCESS_KEY: "AKIARW42XBTC73TMX4XU"
      # BOUKKER_MEDIA_PARAM_SECRET_ACCESS_KEY: "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"
      # BOUKKER_MEDIA_PARAM_TOKEN: ""
      # BOUKKER_MEDIA_PARAM_REGION: "ca-central-1"

    command: "./server"
    restart: "unless-stopped"

  v2MediaREST:
    image: ernestofg/boukker-media:dev-93efe9c5
    depends_on:
        - "v2Redis"
    networks:
      - "v2MediaREST"
      - "v2MediaGRPC"
    ports:
      - "7081:80"
      - "7044:443"
    volumes:
      - "./v2/boukker-media-rest/permissions.json:/opt/media-rest/permissions.json"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-rest/ssl:/opt/media-rest/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-rest/data:/opt/media-rest/data"
    environment:
      BOUKKER_MEDIA_TYPE_ENV: "local"
      BOUKKER_MEDIA_SERVER_HTTP_DOMAIN_PORT: ":80"
      BOUKKER_MEDIA_SERVER_HTTPS_DOMAIN_PORT: ":443"
      BOUKKER_MEDIA_SERVER_HTTPS_PATH_CERT: "/opt/media-rest/cert/server/server-cert.pem"
      BOUKKER_MEDIA_SERVER_HTTPS_PATH_KEY: "/opt/media-rest/cert/server/server-key.pem"
      BOUKKER_MEDIA_MAX_MEMORY_UPLOAD: "31457280"
      BOUKKER_MEDIA_MS_STORIES_REQ_MAX_SIZE: "104857600"
      BOUKKER_MEDIA_MS_STORIES_REQ_MAX_COUNT: "1"
      BOUKKER_MEDIA_MS_STORIES_REQ_ALLOW_MIME_TYPES: "image/jpg,image/jpeg,image/png,video/mp4"
      BOUKKER_MEDIA_SECRET_KEY_HANDLE_TOKEN: "1029azyb8374cwdv"
      BOUKAPI_COMMONS_AUTH_PERMISSIONS: "/opt/media-rest/permissions.json"
      BOUKAPI_COMMONS_AUTH_PERMISSIONS_FOR_MS: "/opt/media-rest/permissions.json"
      BOUKKER_MEDIA_HEADER_CORS_HEADERS: "*"
      BOUKKER_MEDIA_HEADER_CORS_ORIGIN: "*"
      BOUKKER_MEDIA_HEADER_CORS_METHODS: "*"
      BOUKKER_MEDIA_DEBUG: "true"
      BOUKKER_MEDIA_DB_NETWORK: "tcp"
      BOUKKER_MEDIA_DB_ADDRESS: "v2Redis:6379"
      BOUKKER_MEDIA_DB_PASSWORD: "${BOUKKER_V2_REDIS_PASSWORD}"
      BOUKKER_MEDIA_DB_IDX: "0"
      BOUKKER_MEDIA_DB_PREFIX_HASH: "file"
      BOUKKER_MEDIA_KEY_CIPHER_TOKEN: "12hdjsAS34ffgSDDFaaS567dff89Aaaa"
      BOUKKER_MEDIA_DESTINATION_TYPE: "files-system"
      BOUKKER_MEDIA_DESTINATION_TARGET: "/opt/media-rest/data"
      BOUKKER_MEDIA_DESTINATION_TARGET_IN: "/upload"

      ###
      ### configuracion aws
      ###

      # BOUKKER_MEDIA_TYPE_ENV: "aws"
      # BOUKKER_MEDIA_SERVER_HTTP_DOMAIN_PORT: ":80"
      # BOUKKER_MEDIA_SERVER_HTTPS_DOMAIN_PORT: ":443"
      # BOUKKER_MEDIA_SERVER_HTTPS_PATH_CERT: "/opt/media-rest/cert/server/server-cert.pem"
      # BOUKKER_MEDIA_SERVER_HTTPS_PATH_KEY: "/opt/media-rest/cert/server/server-key.pem"
      # BOUKKER_MEDIA_MAX_MEMORY_UPLOAD: "31457280"
      # BOUKKER_MEDIA_MS_STORIES_REQ_MAX_SIZE: "/boukker/media/stories-req-max-size" #bytes
      # BOUKKER_MEDIA_MS_STORIES_REQ_MAX_COUNT: "/boukker/media/stories-req-max-count"
      # BOUKKER_MEDIA_MS_STORIES_REQ_ALLOW_MIME_TYPES: "/boukker/media/stories-req-allow-mime-types"
      # BOUKKER_MEDIA_SECRET_KEY_HANDLE_TOKEN: "/boukker/admin/secret-key-handle-token"
      # BOUKAPI_COMMONS_AUTH_PERMISSIONS: "/boukker/admin/permissions"
      # BOUKAPI_COMMONS_AUTH_PERMISSIONS_FOR_MS: "/boukker/admin/permissions-for-ms"
      # BOUKKER_MEDIA_HEADER_CORS_HEADERS: "/boukker/admin/cors-headers"
      # BOUKKER_MEDIA_HEADER_CORS_ORIGIN: "/boukker/admin/cors-origin"
      # BOUKKER_MEDIA_HEADER_CORS_METHODS: "/boukker/admin/cors-methods"
      # BOUKKER_MEDIA_DEBUG: "/boukker/admin/debug"
      # BOUKKER_MEDIA_DB_NETWORK: "tcp"
      # BOUKKER_MEDIA_DB_ADDRESS: "boukker_v2Redis_1:6379"
      # BOUKKER_MEDIA_DB_PASSWORD: "boukker-redis.123"
      # BOUKKER_MEDIA_DB_IDX: "0"
      # BOUKKER_MEDIA_DB_PREFIX_HASH: "file"
      # BOUKKER_MEDIA_KEY_CIPHER_TOKEN: "12hdjsAS34ffgSDDFaaS567dff89Aaaa"
      # BOUKKER_MEDIA_DESTINATION_TYPE: "/boukker/media/destination-type"
      # BOUKKER_MEDIA_DESTINATION_TARGET: "/boukker/media/destination-target"
      # BOUKKER_MEDIA_DESTINATION_TARGET_IN: "/boukker/media/destination-target-in"
      # BOUKKER_MEDIA_S3_ACCESS_KEY: "/boukker/media/s3-access-key"
      # BOUKKER_MEDIA_S3_SECRET_ACCESS_KEY: "/boukker/media/s3-secret-access-key"
      # BOUKKER_MEDIA_S3_TOKEN: "/boukker/media/s3-token"
      # BOUKKER_MEDIA_S3_REGION: "/boukker/media/s3-region"
      # BOUKKER_MEDIA_PARAM_ACCESS_KEY: "AKIARW42XBTC73TMX4XU"
      # BOUKKER_MEDIA_PARAM_SECRET_ACCESS_KEY: "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"
      # BOUKKER_MEDIA_PARAM_TOKEN: ""
      # BOUKKER_MEDIA_PARAM_REGION: "ca-central-1"

    command: "./server"
    restart: "unless-stopped"

  v2Comments:
    image: ernestofg/boukker-comments:dev-65b89415
    depends_on:
      - "v2mongodb"
      - "v2MessageBroker"
      - "v2AccountsTemp"
      - "v2Stories"
      - "v2Posts"
    networks:
      - "v2"
      - "v2Stories"
      - "general"
      - "v2AccountsTemp"
      - "v2Comments"
      - "v2Posts"
    ports:
      - "7007:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-comments/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-stories/ssl:/opt/stories/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/accounts/cert"
      
    environment:
      COMMON_APPNAME: "boukker-comments-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_COMMENTS_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_COMMENTS_DB_MONGO_DATABASE: "${BOUKKER_V2_COMMENTS_MONGODB_DB_NAME}"

      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_SERVER_ADDRESS: "v2AccountsTemp:50052"
      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_SERVER_NAME: "boukker-accounts-temp-service"
      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_USE_TLS: "true"
      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_CERT: "/opt/accounts/cert/client/client-cert.pem"
      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_KEY: "/opt/accounts/cert/client/client-key.pem"
      BOUKKER_COMMENTS_ACCOUNTS_CLIENT_SERVER_CAS: "/opt/accounts/cert/server/server-ca-cert.pem"

      BOUKKER_COMMENTS_STORIES_CLIENT_SERVER_ADDRESS: "v2Stories:50052"
      BOUKKER_COMMENTS_STORIES_CLIENT_SERVER_NAME: "boukker-stories-service"
      BOUKKER_COMMENTS_STORIES_CLIENT_USE_TLS: "true"
      BOUKKER_COMMENTS_STORIES_CLIENT_CERT: "/opt/stories/cert/client/client-cert.pem"
      BOUKKER_COMMENTS_STORIES_CLIENT_KEY: "/opt/stories/cert/client/client-key.pem"
      BOUKKER_COMMENTS_STORIES_CLIENT_SERVER_CAS: "/opt/stories/cert/server/server-ca-cert.pem"

      BOUKKER_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"

      BOUKKER_STORIES_PUBLISHER_SUBJECT_UPDATE_TOTAL_COMMENTS: "commentsMB.stories.updateTotalComments"
      BOUKKER_REACTIONS_PUBLISHER_SUBJECT_REMOVE_ALL_REACTIONS: "mb.reactions.removeAllReactions"
      BOUKKER_NOTIFICATIONS_PUBLISHER_SUBJECT_ADD_NOTIFICATION: "mb.notifications.addNotification"

      BOUKKER_COMMENTS_SUBSCRIBER_SUBJECT_REMOVE_ALL_COMMENTS: "storiesMB.comments.removeAllComments"
      BOUKKER_COMMENTS_SUBSCRIBER_SUBJECT_UPDATE_TOTAL_REACTIONS: "reactionsMB.comments.updateTotalReactions"
      BOUKKER_COMMENTS_SUBSCRIBER_SUBJECT_COMMENT_USER_UPDATE: "comments.accounts.update"

    command: "./server"
    restart: "unless-stopped"

  v2Posts:
    image: ernestofg/boukker-posts:dev-5523ff92
    depends_on:
      - "v1DB"
    networks:
      - v1
      - v2
      - v2Stories
      - v2Posts
      - general
    ports:
      - "7008:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-posts/ssl:/opt/service/cert"
    environment:
      COMMON_APPNAME: "boukker-posts-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_POSTS_MYSQL_CONNECTION: "${BOUKKER_V1_DB_USER}:${BOUKKER_V1_DB_PASSWORD}@tcp(v1DB:3306)/${BOUKKER_V1_DB_NAME}"
      BOUKKER_POSTS_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_POSTS_DB_MONGO_DATABASE: "${BOUKKER_V2_POSTS_MONGODB_DB_NAME}"

    command: "./server"
    restart: "unless-stopped"

  v2Reactions:
    image: ernestofg/boukker-reactions:dev-62573be8
    depends_on:
      - "v2mongodb"
      - "v2MessageBroker"
      - "v2AccountsTemp"
      - "v2Stories"
      - "v2Posts"
      - "v2Comments"
    networks:
      - "v2"
      - "v2Stories"
      - "general"
      - "v2AccountsTemp"
      - "v2Comments"
      - "v2Posts"
    ports:
      - "7009:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-reactions/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-comments/ssl:/opt/comments/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-stories/ssl:/opt/stories/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/accounts/cert"
      
    environment:
      COMMON_APPNAME: "boukker-reactions-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_REACTIONS_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_REACTIONS_DB_MONGO_DATABASE: "${BOUKKER_V2_REACTIONS_MONGODB_DB_NAME}"

      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_SERVER_ADDRESS: "v2AccountsTemp:50052"
      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_SERVER_NAME: "boukker-accounts-temp-service"
      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_USE_TLS: "true"
      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_CERT: "/opt/accounts/cert/client/client-cert.pem"
      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_KEY: "/opt/accounts/cert/client/client-key.pem"
      BOUKKER_REACTIONS_ACCOUNTS_CLIENT_SERVER_CAS: "/opt/accounts/cert/server/server-ca-cert.pem"

      BOUKKER_REACTIONS_STORIES_CLIENT_SERVER_ADDRESS: "v2Stories:50052"
      BOUKKER_REACTIONS_STORIES_CLIENT_SERVER_NAME: "boukker-stories-service"
      BOUKKER_REACTIONS_STORIES_CLIENT_USE_TLS: "true"
      BOUKKER_REACTIONS_STORIES_CLIENT_CERT: "/opt/stories/cert/client/client-cert.pem"
      BOUKKER_REACTIONS_STORIES_CLIENT_KEY: "/opt/stories/cert/client/client-key.pem"
      BOUKKER_REACTIONS_STORIES_CLIENT_SERVER_CAS: "/opt/stories/cert/server/server-ca-cert.pem"

      BOUKKER_REACTIONS_COMMENTS_CLIENT_SERVER_ADDRESS: "v2Comments:50052"
      BOUKKER_REACTIONS_COMMENTS_CLIENT_SERVER_NAME: "boukker-comments-service"
      BOUKKER_REACTIONS_COMMENTS_CLIENT_USE_TLS: "true"
      BOUKKER_REACTIONS_COMMENTS_CLIENT_CERT: "/opt/comments/cert/client/client-cert.pem"
      BOUKKER_REACTIONS_COMMENTS_CLIENT_KEY: "/opt/comments/cert/client/client-key.pem"
      BOUKKER_REACTIONS_COMMENTS_CLIENT_SERVER_CAS: "/opt/comments/cert/server/server-ca-cert.pem"

      BOUKKER_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"

      BOUKKER_STORIES_PUBLISHER_SUBJECT_UPDATE_TOTAL_REACTIONS: "reactionsMB.stories.updateTotalReactions"
      BOUKKER_NOTIFICATIONS_PUBLISHER_SUBJECT_ADD_NOTIFICATION: "mb.notifications.addNotification"
      BOUKKER_COMMENTS_PUBLISHER_SUBJECT_UPDATE_TOTAL_REACTIONS: "reactionsMB.comments.updateTotalReactions"

      BOUKKER_REACTIONS_SUBSCRIBER_SUBJECT_REMOVE_ALL_REACTIONS: "mb.reactions.removeAllReactions"
      BOUKKER_REACTIONS_SUBSCRIBER_SUBJECT_REACTION_USER_UPDATE: "reactions.accounts.update"

    command: "./server"
    restart: "unless-stopped"

  v2Payments:
    image: ernestofg/boukker-payments:dev-8d42117c
    depends_on:
      - "v2mongodb"
      - "v2MessageBroker"
      - "v2AccountsTemp"
      - "v2Stories"
    networks:
      - "v2"
      - "v2Stories"
      - "general"
      - "v2AccountsTemp"
      - "v2Payments"
    ports:
      - "7010:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-payments/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-stories/ssl:/opt/stories/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/accounts/cert"
      
    environment:
      COMMON_APPNAME: "boukker-payments-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      
      BOUKKER_PAYMENTS_DB_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_PAYMENTS_DB_MONGO_DATABASE: "${BOUKKER_V2_PAYMENTS_MONGODB_DB_NAME}"

      BOUKKER_PAYMENTS_STRIPE_SECRET_KEY: "${BOUKKER_V2_PAYMENTS_STRIPE_SECRET_KEY}"

      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_SERVER_ADDRESS: "v2AccountsTemp:50052"
      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_SERVER_NAME: "boukker-accounts-temp-service"
      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_USE_TLS: "true"
      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_CERT: "/opt/accounts/cert/client/client-cert.pem"
      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_KEY: "/opt/accounts/cert/client/client-key.pem"
      BOUKKER_PAYMENTS_ACCOUNTS_CLIENT_SERVER_CAS: "/opt/accounts/cert/server/server-ca-cert.pem"

      BOUKKER_PAYMENTS_STORIES_CLIENT_SERVER_ADDRESS: "v2Stories:50052"
      BOUKKER_PAYMENTS_STORIES_CLIENT_SERVER_NAME: "boukker-stories-service"
      BOUKKER_PAYMENTS_STORIES_CLIENT_USE_TLS: "true"
      BOUKKER_PAYMENTS_STORIES_CLIENT_CERT: "/opt/stories/cert/client/client-cert.pem"
      BOUKKER_PAYMENTS_STORIES_CLIENT_KEY: "/opt/stories/cert/client/client-key.pem"
      BOUKKER_PAYMENTS_STORIES_CLIENT_SERVER_CAS: "/opt/stories/cert/server/server-ca-cert.pem"

      BOUKKER_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"

      BOUKKER_PAYMENTS_PUBLISHER_SUBJECT_UPDATE_TOTAL_COFFES: "stories.payments.updateCoffes"
      BOUKKER_NOTIFICATIONS_PUBLISHER_SUBJECT_ADD_NOTIFICATION: "mb.notifications.addNotification"

    command: "./server"
    restart: "unless-stopped"

  v2Chat:
     image: ernestofg/boukker-chat:develop-3ebec9f8
     depends_on:
       - "v2mongodb"
       - "v2Emqx"
     networks:
       - "v2"
       - "general"
       - "v2Chat"
       - "v2Emqx"
     links:
       - v2Emqx
     ports:
       - "7011:50052"
       - "7013:50053"
     volumes:
       - "${BOUKKER_GITIGNORE}/v2/boukker-chat/ssl:/opt/service/cert"
     environment:
       COMMON_APPNAME: "boukker-chat-service"
       COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
       COMMON_DEBUG_MODE: "true"
       COMMON_USE_TLS: "true"
       COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
       COMMON_KEY: "/opt/service/cert/server/server-key.pem"
       COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
       BOUKKER_CHAT_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
       BOUKKER_CHAT_EMQX_CONNECTION: "tcp://v2Emqx:1883"
       BOUKKER_CHAT_MONGO_BOUKKER_DATABASE_NAME: "boukker"
       BOUKKER_CHAT_MONGO_DATABASE_USERS_COLLECTION_NAME: "users"
       BOUKKER_CHAT_MONGO_DATABASE_USERS_FOLLOWERS_COLLECTION_NAME: "users-followers"
       BOUKKER_CHAT_MONGO_DATABASE_CHAT_CONVERSATIONS_COLLECTION_NAME: "chat-conversations"
       BOUKKER_CHAT_MONGO_DATABASE_CHAT_MESSAGES_COLLECTION_NAME: "chat-messages"
       BOUKKER_CHAT_MONGO_DATABASE_CHAT_GROUP_CHATS_COLLECTION_NAME: "chat-group-chats"
       BOUKKER_CHAT_MONGO_DATABASE_CHAT_GROUP_CHATS_MEMBERS_COLLECTION_NAME: "chat-group-chats-members"
       BOUKKER_CHAT_MONGO_LITERARY_CATEGORIES_DATABASE_NAME: "literaryCategories"
       BOUKKER_CHAT_MONGO_DATABASE_LITERARY_CATEGORIES_COLLECTION_NAME: "categories"
     command: "./server"
     restart: "unless-stopped"

  #EMQX broker (chat service)
  v2Emqx:
     image: emqx/emqx:4.2.1
     networks:
       - "v2"
       - "general"
       - "v2Chat"
       - "v2Emqx"
     environment:
       - EMQX_LISTENER__WSS__EXTERNAL__MAX_CONNECTIONS=102400
       # Enabled plugins.
       - EMQX_LOADED_PLUGINS="emqx_management,emqx_conf,emqx_auth_http,emqx_web_hook,emqx_rule_engine,emqx_schema_registry,emqx_recon,emqx_retainer,emqx_dashboard"
       # Web hooks
       - EMQX_WEB__HOOK__API__URL=http://v2Chat:50053/mqtt/status
       - EMQX_WEB__HOOK__RULE__CLIENT__CONNECTED__1={"action":"on_client_connected"}
       - EMQX_WEB__HOOK__RULE__CLIENT__DISCONNECTED__1={"action":"on_client_disconnected"}
       # User authentication request.
       - EMQX_AUTH__HTTP__AUTH_REQ=http://v2Chat:50053/mqtt/auth
       - EMQX_AUTH__HTTP__AUTH_REQ__METHOD=post
       - EMQX_AUTH__HTTP__AUTH_REQ__PARAMS=clientid=%c,username=%u,password=%P
       # Superuser authentication request.
       - EMQX_AUTH__HTTP__SUPER_REQ=http://v2Chat:50053/mqtt/superuser
       - EMQX_AUTH__HTTP__SUPER_REQ__METHOD=post
       - EMQX_AUTH__HTTP__SUPER_REQ__PARAMS=clientid=%c,username=%u
       # ACL request.
       - EMQX_AUTH__HTTP__ACL_REQ=http://v2Chat:50053/mqtt/acl
       - EMQX_AUTH__HTTP__ACL_REQ__METHOD=post
       - EMQX_AUTH__HTTP__ACL_REQ__PARAMS=access=%A,username=%u,clientid=%c,ipaddr=%a,topic=%t
     ports:
       - "18084:18083"
       - "1883:1883"
       - "8083:8083"
       - "8884:8884"
       #- "4369:4369" #Cluster
       #- "6000-6100:6000-6100"#Cluster
     restart: always

  v2Notifications:
    image: ernestofg/boukker-notifications:dev-db9afb06
    depends_on:
      - "v1Server"
      - "v2MessageBroker"
    networks:
      - v2
      - v2Notifications
      - general
    ports:
      - "7012:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-notifications/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v1/boukker-v1v2api/ssl:/opt/boukker-v1v2api/cert"
    environment:
      COMMON_APPNAME: "boukker-notifications-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"

      BOUKKER_V1_V2_API_CLIENT_URL: "https://v1Server:7001"
      BOUKKER_V1_V2_API_CLIENT_USE_TLS: "true"
      BOUKKER_V1_V2_API_CLIENT_SERVER_NAME: "boukker-v1v2api-service"
      BOUKKER_V1_V2_API_CLIENT_CERT: "/opt/boukker-v1v2api/cert/client/client-cert.pem"
      BOUKKER_V1_V2_API_CLIENT_KEY: "/opt/boukker-v1v2api/cert/client/client-key.pem"
      BOUKKER_V1_V2_API_CLIENT_SERVER_CAS: "/opt/boukker-v1v2api/cert/server/server-ca-cert.pem"

      BOUKKER_BROKER_CLIENT_NATS_ADDRESS: "nats://${BOUKKER_V2_MESSAGE_BROKER_TOKEN}@v2MessageBroker:4222/"
      BOUKKER_BROKER_CLIENT_NATS_CLUSTER_ID: "${BOUKKER_V2_MESSAGE_BROKER_CLUSTER_ID}"

      BOUKKER_NOTIFICATIONS_SUBSCRIBER_SUBJECT_ADD_NOTIFICATION: "mb.notifications.addNotification"

    command: "./server"
    restart: "unless-stopped"

  v2Groups:
    image: ernestofg/boukker-groups:dev-4d59e707
    depends_on:
      - "v2mongodb"
    networks:
      - "v2"
      - "general"
      - "v2Groups"
    ports:
      - "7014:50052"
    volumes:
      - "${BOUKKER_GITIGNORE}/v2/boukker-groups/ssl:/opt/service/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-accounts-temp/ssl:/opt/accounts/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-media-grpc/ssl:/opt/media/cert"
      - "${BOUKKER_GITIGNORE}/v2/boukker-literary-categories/ssl:/opt/literary-categories/cert"
    environment:
      #Commons
      COMMON_APPNAME: "boukker-groups-service"
      COMMON_SERVER_ADDRESS: "0.0.0.0:50052"
      COMMON_DEBUG_MODE: "true"
      COMMON_USE_TLS: "true"
      COMMON_CERT: "/opt/service/cert/server/server-cert.pem"
      COMMON_KEY: "/opt/service/cert/server/server-key.pem"
      COMMON_CLIENT_CAS: "/opt/service/cert/client/client-ca-cert.pem"
      #DB
      BOUKKER_GROUPS_MONGO_CONNECTION: "mongodb://${BOUKKER_V2_MONGODB_USER}:${BOUKKER_V2_MONGODB_PASSWORD}@v2mongodb:27017"
      BOUKKER_GROUPS_MONGO_BOUKKER_DATABASE_NAME: "boukker"
      BOUKKER_GROUPS_MONGO_DATABASE_GROUP_COLLECTION_NAME: "groups"
      BOUKKER_GROUPS_MONGO_DATABASE_GROUP_MEMBER_COLLECTION_NAME: "groups-members"
      #Category
      BOUKKER_GROUPS_CATEGORY_CLIENT_SERVER_ADDRESS: "v2LiteraryCategories:50052"
      BOUKKER_GROUPS_CATEGORY_CLIENT_SERVER_NAME: "boukker-literary-categories-service"
      BOUKKER_GROUPS_CATEGORY_CLIENT_USE_TLS: "true"
      BOUKKER_GROUPS_CATEGORY_CLIENT_CERT: "/opt/literary-categories/cert/client/client-cert.pem"
      BOUKKER_GROUPS_CATEGORY_CLIENT_KEY: "/opt/literary-categories/cert/client/client-key.pem"
      BOUKKER_GROUPS_CATEGORY_CLIENT_SERVER_CAS: "/opt/literary-categories/cert/server/server-ca-cert.pem"
      #Account
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_SERVER_ADDRESS: "v2AccountsTemp:50052"
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_SERVER_NAME: "boukker-accounts-temp-service"
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_USE_TLS: "true"
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_CERT: "/opt/accounts/cert/client/client-cert.pem"
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_KEY: "/opt/accounts/cert/client/client-key.pem"
      BOUKKER_GROUPS_ACCOUNTS_CLIENT_SERVER_CAS: "/opt/accounts/cert/server/server-ca-cert.pem"
      #Media
      BOUKKER_GROUPS_MEDIA_CLIENT_SERVER_ADDRESS: "v2MediaGRPC:50052"
      BOUKKER_GROUPS_MEDIA_CLIENT_SERVER_NAME: "boukker-media-grpc-service"
      BOUKKER_GROUPS_MEDIA_CLIENT_USE_TLS: "true"
      BOUKKER_GROUPS_MEDIA_CLIENT_CERT: "/opt/media/cert/client/client-cert.pem"
      BOUKKER_GROUPS_MEDIA_CLIENT_KEY: "/opt/media/cert/client/client-key.pem"
      BOUKKER_GROUPS_MEDIA_CLIENT_SERVER_CAS: "/opt/media/cert/server/server-ca-cert.pem"
      
    command: "./server"
    restart: "unless-stopped"
  
